!function(t){var i={};function e(s){if(i[s])return i[s].exports;var r=i[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)e.d(s,r,function(i){return t[i]}.bind(null,r));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i);let s=L.Class.extend({data:null,next:null,prev:null,initialize(t){this.data=t},index:0});var r=L.Class.extend({_length:0,_head:null,_tail:null,_hash:{},_count:0,add(t){let i=new s(t);return 0==this._length?(this._head=i,this._tail=i):(this._tail.next=i,i.prev=this._tail,this._tail=i),this._length++,i.index=this._count,this._hash[this._count]=i,this._count++,this.resetPositions(),i},insertAfter(t,i){let e=this._head;if(!(0==this._length||i>this._length||i<0)&&null!==e){let e=this.get(i),s=this.get(i+1),r=this.add(t);this._tail=r.prev,delete this._tail.next,r.prev=e,r.next=s,e.next=r,s.prev=r;let a=r;for(;i++<this._length-1;)a.index=i,a=a.next;return this.resetPositions(),r}},get(t){var i=this._head,e=this._length,r=0;if(0===e||t<0||t>e)return new s;for(;r<t;)i=i.next,r++;return i},getLast(){return this.get(this._length-1)},getFirst(){return this.get(0)},remove(t){if(t>-1&&t<this._length){var i=this._head,e=0;if(0===t)this._head=i.next,this._head?this._head.prev=null:this._tail=null;else if(t===this._length-1)i=this._tail,this._tail=i.prev,this._tail.next=null;else{for(;e++<t;)i=i.next;i.prev.next=i.next,i.next.prev=i.prev}for(var s in this._length--,this._hash)this._hash[s]===i&&delete this._hash[s];return this.resetPositions(),i.data}return null},isEmpty(){return 0===this._length},each(t){let i=this._head;for(;null!==i;)null!==i&&t.call(this,i),i=i.next},resetPositions(){let t=0;this.each(i=>{i._position=t++})},_beforeClear(){},clear(){this._beforeClear(),this._length=0,this._head=null,this._tail=null,this._hash={},this._count=0}}),a=L.DivIcon.extend({options:{className:"ruler-icon",iconSize:new L.Point(10,10)}});let n,o=L.Polyline.extend({options:{color:"#4a4a4a",weight:2,clickable:!0}}),h=.3;var l=L.Class.extend({initialize(t){this._map=t,this.rulerOptions=this._map.__dr._options,this.rulerOptions._updateTooltipDistance&&(this._updateTooltipDistance=this.rulerOptions._updateTooltipDistance),this.rulerOptions._createTooltip&&(this._createTooltip=this.rulerOptions._createTooltip),h=this.rulerOptions.cursorOffset||h,n=this._recalcZoom()},_layerPaintPath:null,_layerPaintTemp:null,markers:[],_points:[],_tooltip:[],_hoverMarker:null,_distance:0,isEmpty:t=>""===t||null==t||0===t.length,createMarker(t){let i=L.marker(t,{icon:new a(this.rulerOptions.iconOptions),draggable:!0,isDragging:!1,riseOnHover:!0}).addTo(this._layerPaint);return i.on("dragstart",this._onDragStartMarker.bind(this)),i.on("drag",this._onDragMarker.bind(this)),i.on("dragend",this._onDragEndMarker.bind(this)),i.on("click",this._onClickMarker.bind(this)),i},addMarker(t){let i=this.createMarker(t);return i.node=this.hash.add(i),this.markers.push(i),this._points.push(t),this.resetMarkersPositions(),i},removeMarker(t){let i=t.options.position;this._layerPaintPath.spliceLatLngs(i,1),this.hash.remove(i),this.hash.resetPositions(),this._layerPaint.removeLayer(t),0!==i&&(this._layerPaint.removeLayer(this._tooltip[i-1]),this._tooltip.splice(i-1,1)),0===i&&this._tooltip.length&&(this._layerPaint.removeLayer(this._tooltip[this._tooltip.length-1]),this._tooltip.pop()),this.markers.splice(i,1),this._points.splice(i,1),this.resetMarkersPositions(),this._resetTooltipPositions(),1===this.markers.length&&(this._tooltip=[],this._distance=0)},resetMarkersPositions(){let t=0;this.markers.forEach(i=>{i.options.position=t++})},addHoverMarker(t,i){t.target._map=t.target.__dr._map,this._hoverMarker=L.marker(t.latlng,{icon:new a(this.rulerOptions.iconOptions),draggable:!0,position:this.hash._length}).addTo(this._layerPaint),this._hoverMarker.isDragging=!1,this._hoverMarker.prevMarkerIndex=i,this._hoverMarker.on("dragstart",this._onDragStartHoverMarker.bind(this)),this._hoverMarker.on("drag",this._onDragHoverMarker.bind(this)),this._hoverMarker.on("dragend",this._onDragEndHoverMarker.bind(this)),this._hoverMarker.node=this.hash.insertAfter(this._hoverMarker,i)},removeHoverMarker(t){null!==this._hoverMarker.prevMarkerIndex&&this.hash.remove(this._hoverMarker.prevMarkerIndex+1),this._layerPaint.removeLayer(this._hoverMarker),this._hoverMarker=null},redrawHoverMarker(t,i){this._hoverMarker.setLatLng(t.latlng),i===this._hoverMarker.prevMarkerIndex||this._hoverMarker.isDragging||(this._hoverMarker.node=this.hash.insertAfter(this._hoverMarker,i),this._hoverMarker.prevMarkerIndex=i)},insertAfter(t,i){let e=this.createMarker(i._latlng),s=this._createTooltip(i._latlng);this._layerPaintPath.spliceLatLngs(t,0,i._latlng),s.addTo(this._layerPaint),this.hash.insertAfter(e,t),e.node=this.hash,this.markers.splice(t,0,e),this._tooltip.splice(t,0,s),this._points.splice(t,0,i._latlng),this.resetMarkersPositions()},get(){},getLast(){},getFirst(){},clear(){},_onDragStartMarker(t){t.target.options.isDragging=!0,this._points.splice(t.target.options.position,1,t.target._latlng)},_onDragMarker(t){this._layerPaintPath.spliceLatLngs(t.target.options.position,1,t.target._latlng)},_onDragEndMarker(t){t.target.options.isDragging=!1,this._points.splice(t.target.options.position,1,t.target._latlng),this._resetTooltipPositions()},_onDragStartHoverMarker(t){this._hoverMarker.isDragging=!0,this._layerPaintTemp||(this._layerPaintTemp=L.polyline([this.markers[this._hoverMarker.prevMarkerIndex]._latlng,t.target._latlng,this.markers[this._hoverMarker.prevMarkerIndex+1]._latlng],Object.assign({color:"black",weight:1.5,clickable:!1,dashArray:"6,3"},this.rulerOptions.paintLineOptions)).addTo(this._layerPaint))},_onDragHoverMarker(t){this._layerPaintTemp.spliceLatLngs(0,2,this.markers[this._hoverMarker.prevMarkerIndex]._latlng,t.target._latlng,this.markers[this._hoverMarker.prevMarkerIndex+1]._latlng)},_onDragEndHoverMarker(t){this._hoverMarker.isDragging=!1,this.insertAfter(this._hoverMarker.prevMarkerIndex+1,t.target),this._map=this._map.removeLayer(this._hoverMarker),this._map.removeLayer(this._layerPaintTemp),this._layerPaintTemp=null,this._hoverMarker=null,this._resetTooltipPositions()},_onClickMarker(t){let i=t.target;i._map.__dr.view.removeMarker(i)},__enabled:!1,_toggleMeasure(){this.__enabled=!this.__enabled,this.__enabled?this._startMeasuring():this._stopMeasuring()},_startMeasuring(){this._oldCursor=this._map._container.style.cursor,this._map._container.style.cursor="crosshair",this._doubleClickZoom=this._map.doubleClickZoom.enabled(),this._map.doubleClickZoom.disable(),L.DomEvent.on(this._map,"zoomend",this._zoomChanged,this).on(this._map,"mousemove",this._mouseMove,this).on(this._map,"click",this._mouseClick,this).on(document,"keydown",this._onKeyDown,this),this._layerPaint||(this._layerPaint=L.layerGroup().addTo(this._map)),this._points||(this._points=[])},_stopMeasuring(){this._map._container.style.cursor=this._oldCursor,L.DomEvent.off(document,"keydown",this._onKeyDown,this).off(this._map,"mousemove",this._mouseMove,this).off(this._map,"click",this._mouseClick,this),this._doubleClickZoom&&this._map.doubleClickZoom.enable(),this._layerPaint&&this._layerPaint.clearLayers(),this._restartPath()},_mouseMove(t){if(!t.latlng||!this._lastPoint)return;let i,e,s,r=n,a=n;if(this.markers.forEach((n,o)=>{let h=L.point(t.latlng.lat,t.latlng.lng).distanceTo(L.point(this.markers[o]._latlng.lat,this.markers[o]._latlng.lng));h&&h<a?(s=this.markers[o],a=h):o!==this.markers.length-1&&(h=this._calcHoverMarkerCoordinates(t.latlng,this.markers[o],this.markers[o+1]))&&h.distance&&h.distance<r&&(i=h.latlng,r=h.distance,e=o)}),!this.isEmpty(i)&&this.isEmpty(this.markers.find(t=>t.options.isDragging))){let s=t;s.latlng=i,this.isEmpty(this._hoverMarker)?this.addHoverMarker(s,e):this.redrawHoverMarker(s,e)}else console.log("!this.isEmpty(this._hoverMarker)",this._hoverMarker&&!this._hoverMarker.isDragging),this._hoverMarker&&!this._hoverMarker.isDragging&&this.removeHoverMarker(t);if(this.rulerOptions.paintLineOptions&&(this._layerPaintPathTemp?this._layerPaintPathTemp.spliceLatLngs(0,2,this._lastPoint,t.latlng):this._layerPaintPathTemp=L.polyline([this._lastPoint,t.latlng],Object.assign({color:"black",weight:1.5,clickable:!1,dashArray:"6,3"},this.rulerOptions.paintLineOptions)).addTo(this._layerPaint),this._tooltip.length)){let e=i?L.latLng(i):t.latlng;if(this._updateTooltipPosition(this._tooltip[this._tooltip.length-1],e),!this._lastPoint.equals(e)){var o=e.distanceTo(this._lastPoint);this._updateTooltipDistance(this._tooltip[this._tooltip.length-1],this._distance+o,o)}}},_mouseClick(t){if(t.latlng&&this.isEmpty(this._hoverMarker)){if(this.addMarker(t.latlng),this.markers.length>1&&this._addTooltip(t.latlng),this._lastPoint&&this._tooltip.length){this._updateTooltipPosition(this._tooltip[this._tooltip.length-1],t.latlng);var i=t.latlng.distanceTo(this._lastPoint);this._updateTooltipDistance(this._tooltip[this._tooltip.length-1],this._distance+i,i),this._distance+=i}this._lastPoint&&!this._layerPaintPath&&(this._layerPaintPath=new o([this._lastPoint],this.rulerOptions.lineOptions).addTo(this._layerPaint)),this._layerPaintPath&&this._layerPaintPath.addLatLng(t.latlng),this._lastPoint=t.latlng}},_recalcZoom:function(t=this._map.getZoom()){return h*Math.pow(2,7-t)},_zoomChanged(){let t=this._map.getZoom();n=this._recalcZoom(t)},_restartPath(){this._distance=0,this._tooltip=[],this._lastCircle=void 0,this._lastPoint=void 0,this._layerPaintPath=void 0,this._layerPaintPathTemp=void 0,this.hash.clear(),this.markers=[],this._points=[]},_createTooltip(t){var i;return i=L.divIcon({className:"ruler-tooltip",iconAnchor:[-5,-5]}),L.marker(t,{icon:i,clickable:!1})},_addTooltip(t){var i=this._createTooltip(t);return this._tooltip.push(i),i.addTo(this._layerPaint),i},_updateTooltipPosition(t,i){t.setLatLng(i),t.update()},_updateTooltipDistance(t,i,e){var s='<div class="ruler-tooltip-total">'+i+" m</div>";e>0&&i!=e&&(s+='<div class="ruler-tooltip-difference">(+'+e+" m)</div>"),t._icon.innerHTML=s},_resetTooltipPositions(){var t=0;if(this._points.length&&this._tooltip.length)for(var i=0;i<this._points.length-1;i++){this._updateTooltipPosition(this._tooltip[i],this._points[i+1]);var e=this._points[i].distanceTo(this._points[i+1]);this._updateTooltipDistance(this._tooltip[i],t+e,e),t+=e}},_onKeyDown(t){27==t.keyCode&&(this._lastPoint?this._finishPath():this._toggleMeasure())},hash:new r,_calcHoverMarkerCoordinates(t,i,e){let s=t.lat,r=t.lng,a=i._latlng.lat,o=i._latlng.lng,h=e._latlng.lat,l=e._latlng.lng,_=L.point(a,o).distanceTo(L.point(h,l)),p=L.point(s,r).distanceTo(L.point(a,o)),d=L.point(s,r).distanceTo(L.point(h,l)),g=l-o,c=a-h,u=-a*l+h*o,v=L.point(g,c).distanceTo(L.point(0,0)),k=Math.abs((g*s+c*r+u)/v);if(p>=L.point(d,_).distanceTo(L.point(0,0))||d>=L.point(p,_).distanceTo(L.point(0,0)))return{latlng:null,distance:k};if(k<n){let t=((s-a)*(h-a)+(r-o)*(l-o))/(Math.pow(h-a,2)+Math.pow(l-o,2));return{latlng:{lat:a-c*t,lng:o+g*t},distance:k}}}});L.MapDistanceRuler=L.Layer.extend({baseOptions:{renderRuler:null,iconOptions:{draggable:!0},lastNodeOptions:{},lineOptions:{},paintLineOptions:!1},initialize(t){this._options=Object.assign({},this.baseOptions,t)},onAdd(t){this._map=t,this._map.__dr=this,this.view=new l(this._map)},onRemove(t){},view:null}),L.mapDistanceRuler=function(t){return new L.MapDistanceRuler(t)}}]);